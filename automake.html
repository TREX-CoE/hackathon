<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
<head>
<!-- 2021-11-03 Wed 13:20 -->
<meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Automake</title>
<meta name="generator" content="Org mode" />
<meta name="author" content="Evgeny Posenitskiy, Anthony Scemama" />
<style type="text/css">
 <!--/*--><![CDATA[/*><!--*/
  .title  { text-align: center;
             margin-bottom: .2em; }
  .subtitle { text-align: center;
              font-size: medium;
              font-weight: bold;
              margin-top:0; }
  .todo   { font-family: monospace; color: red; }
  .done   { font-family: monospace; color: green; }
  .priority { font-family: monospace; color: orange; }
  .tag    { background-color: #eee; font-family: monospace;
            padding: 2px; font-size: 80%; font-weight: normal; }
  .timestamp { color: #bebebe; }
  .timestamp-kwd { color: #5f9ea0; }
  .org-right  { margin-left: auto; margin-right: 0px;  text-align: right; }
  .org-left   { margin-left: 0px;  margin-right: auto; text-align: left; }
  .org-center { margin-left: auto; margin-right: auto; text-align: center; }
  .underline { text-decoration: underline; }
  #postamble p, #preamble p { font-size: 90%; margin: .2em; }
  p.verse { margin-left: 3%; }
  pre {
    border: 1px solid #ccc;
    box-shadow: 3px 3px 3px #eee;
    padding: 8pt;
    font-family: monospace;
    overflow: auto;
    margin: 1.2em;
  }
  pre.src {
    position: relative;
    overflow: visible;
    padding-top: 1.2em;
  }
  pre.src:before {
    display: none;
    position: absolute;
    background-color: white;
    top: -10px;
    right: 10px;
    padding: 3px;
    border: 1px solid black;
  }
  pre.src:hover:before { display: inline;}
  /* Languages per Org manual */
  pre.src-asymptote:before { content: 'Asymptote'; }
  pre.src-awk:before { content: 'Awk'; }
  pre.src-C:before { content: 'C'; }
  /* pre.src-C++ doesn't work in CSS */
  pre.src-clojure:before { content: 'Clojure'; }
  pre.src-css:before { content: 'CSS'; }
  pre.src-D:before { content: 'D'; }
  pre.src-ditaa:before { content: 'ditaa'; }
  pre.src-dot:before { content: 'Graphviz'; }
  pre.src-calc:before { content: 'Emacs Calc'; }
  pre.src-emacs-lisp:before { content: 'Emacs Lisp'; }
  pre.src-fortran:before { content: 'Fortran'; }
  pre.src-gnuplot:before { content: 'gnuplot'; }
  pre.src-haskell:before { content: 'Haskell'; }
  pre.src-hledger:before { content: 'hledger'; }
  pre.src-java:before { content: 'Java'; }
  pre.src-js:before { content: 'Javascript'; }
  pre.src-latex:before { content: 'LaTeX'; }
  pre.src-ledger:before { content: 'Ledger'; }
  pre.src-lisp:before { content: 'Lisp'; }
  pre.src-lilypond:before { content: 'Lilypond'; }
  pre.src-lua:before { content: 'Lua'; }
  pre.src-matlab:before { content: 'MATLAB'; }
  pre.src-mscgen:before { content: 'Mscgen'; }
  pre.src-ocaml:before { content: 'Objective Caml'; }
  pre.src-octave:before { content: 'Octave'; }
  pre.src-org:before { content: 'Org mode'; }
  pre.src-oz:before { content: 'OZ'; }
  pre.src-plantuml:before { content: 'Plantuml'; }
  pre.src-processing:before { content: 'Processing.js'; }
  pre.src-python:before { content: 'Python'; }
  pre.src-R:before { content: 'R'; }
  pre.src-ruby:before { content: 'Ruby'; }
  pre.src-sass:before { content: 'Sass'; }
  pre.src-scheme:before { content: 'Scheme'; }
  pre.src-screen:before { content: 'Gnu Screen'; }
  pre.src-sed:before { content: 'Sed'; }
  pre.src-sh:before { content: 'shell'; }
  pre.src-sql:before { content: 'SQL'; }
  pre.src-sqlite:before { content: 'SQLite'; }
  /* additional languages in org.el's org-babel-load-languages alist */
  pre.src-forth:before { content: 'Forth'; }
  pre.src-io:before { content: 'IO'; }
  pre.src-J:before { content: 'J'; }
  pre.src-makefile:before { content: 'Makefile'; }
  pre.src-maxima:before { content: 'Maxima'; }
  pre.src-perl:before { content: 'Perl'; }
  pre.src-picolisp:before { content: 'Pico Lisp'; }
  pre.src-scala:before { content: 'Scala'; }
  pre.src-shell:before { content: 'Shell Script'; }
  pre.src-ebnf2ps:before { content: 'ebfn2ps'; }
  /* additional language identifiers per "defun org-babel-execute"
       in ob-*.el */
  pre.src-cpp:before  { content: 'C++'; }
  pre.src-abc:before  { content: 'ABC'; }
  pre.src-coq:before  { content: 'Coq'; }
  pre.src-groovy:before  { content: 'Groovy'; }
  /* additional language identifiers from org-babel-shell-names in
     ob-shell.el: ob-shell is the only babel language using a lambda to put
     the execution function name together. */
  pre.src-bash:before  { content: 'bash'; }
  pre.src-csh:before  { content: 'csh'; }
  pre.src-ash:before  { content: 'ash'; }
  pre.src-dash:before  { content: 'dash'; }
  pre.src-ksh:before  { content: 'ksh'; }
  pre.src-mksh:before  { content: 'mksh'; }
  pre.src-posh:before  { content: 'posh'; }
  /* Additional Emacs modes also supported by the LaTeX listings package */
  pre.src-ada:before { content: 'Ada'; }
  pre.src-asm:before { content: 'Assembler'; }
  pre.src-caml:before { content: 'Caml'; }
  pre.src-delphi:before { content: 'Delphi'; }
  pre.src-html:before { content: 'HTML'; }
  pre.src-idl:before { content: 'IDL'; }
  pre.src-mercury:before { content: 'Mercury'; }
  pre.src-metapost:before { content: 'MetaPost'; }
  pre.src-modula-2:before { content: 'Modula-2'; }
  pre.src-pascal:before { content: 'Pascal'; }
  pre.src-ps:before { content: 'PostScript'; }
  pre.src-prolog:before { content: 'Prolog'; }
  pre.src-simula:before { content: 'Simula'; }
  pre.src-tcl:before { content: 'tcl'; }
  pre.src-tex:before { content: 'TeX'; }
  pre.src-plain-tex:before { content: 'Plain TeX'; }
  pre.src-verilog:before { content: 'Verilog'; }
  pre.src-vhdl:before { content: 'VHDL'; }
  pre.src-xml:before { content: 'XML'; }
  pre.src-nxml:before { content: 'XML'; }
  /* add a generic configuration mode; LaTeX export needs an additional
     (add-to-list 'org-latex-listings-langs '(conf " ")) in .emacs */
  pre.src-conf:before { content: 'Configuration File'; }

  table { border-collapse:collapse; }
  caption.t-above { caption-side: top; }
  caption.t-bottom { caption-side: bottom; }
  td, th { vertical-align:top;  }
  th.org-right  { text-align: center;  }
  th.org-left   { text-align: center;   }
  th.org-center { text-align: center; }
  td.org-right  { text-align: right;  }
  td.org-left   { text-align: left;   }
  td.org-center { text-align: center; }
  dt { font-weight: bold; }
  .footpara { display: inline; }
  .footdef  { margin-bottom: 1em; }
  .figure { padding: 1em; }
  .figure p { text-align: center; }
  .inlinetask {
    padding: 10px;
    border: 2px solid gray;
    margin: 10px;
    background: #ffffcc;
  }
  #org-div-home-and-up
   { text-align: right; font-size: 70%; white-space: nowrap; }
  textarea { overflow-x: auto; }
  .linenr { font-size: smaller }
  .code-highlighted { background-color: #ffff00; }
  .org-info-js_info-navigation { border-style: none; }
  #org-info-js_console-label
    { font-size: 10px; font-weight: bold; white-space: nowrap; }
  .org-info-js_search-highlight
    { background-color: #ffff00; color: #000000; font-weight: bold; }
  .org-svg { width: 90%; }
  /*]]>*/-->
</style>
<link rel="stylesheet" type="text/css" href="org-html-themes/src/readtheorg_theme/css/htmlize.css"/>
<link rel="stylesheet" type="text/css" href="org-html-themes/src/readtheorg_theme/css/readtheorg.css"/>
<script type="text/javascript" src="org-html-themes/src/lib/js/jquery.min.js"></script>
<script type="text/javascript" src="org-html-themes/src/lib/js/bootstrap.min.js"></script>
<script type="text/javascript" src="org-html-themes/src/lib/js/jquery.stickytableheaders.min.js"></script>
<script type="text/javascript" src="org-html-themes/src/readtheorg_theme/js/readtheorg.js"></script>
<script type="text/javascript">
/*
@licstart  The following is the entire license notice for the
JavaScript code in this tag.

Copyright (C) 2012-2019 Free Software Foundation, Inc.

The JavaScript code in this tag is free software: you can
redistribute it and/or modify it under the terms of the GNU
General Public License (GNU GPL) as published by the Free Software
Foundation, either version 3 of the License, or (at your option)
any later version.  The code is distributed WITHOUT ANY WARRANTY;
without even the implied warranty of MERCHANTABILITY or FITNESS
FOR A PARTICULAR PURPOSE.  See the GNU GPL for more details.

As additional permission under GNU GPL version 3 section 7, you
may distribute non-source (e.g., minimized or compacted) forms of
that code without the copy of the GNU GPL normally required by
section 4, provided you include this license notice and a URL
through which recipients can access the Corresponding Source.


@licend  The above is the entire license notice
for the JavaScript code in this tag.
*/
<!--/*--><![CDATA[/*><!--*/
 function CodeHighlightOn(elem, id)
 {
   var target = document.getElementById(id);
   if(null != target) {
     elem.cacheClassElem = elem.className;
     elem.cacheClassTarget = target.className;
     target.className = "code-highlighted";
     elem.className   = "code-highlighted";
   }
 }
 function CodeHighlightOff(elem, id)
 {
   var target = document.getElementById(id);
   if(elem.cacheClassElem)
     elem.className = elem.cacheClassElem;
   if(elem.cacheClassTarget)
     target.className = elem.cacheClassTarget;
 }
/*]]>*///-->
</script>
</head>
<body>
<div id="org-div-home-and-up">
 <a accesskey="h" href="index.html"> UP </a>
 |
 <a accesskey="H" href="index.html"> HOME </a>
</div><div id="content">
<h1 class="title">Automake</h1>
<div id="table-of-contents">
<h2>Table of Contents</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="#orgbac552f">1. Introduction</a></li>
<li><a href="#org5dbdef3">2. GNU standards</a>
<ul>
<li><a href="#orgfc5a5d0">2.1. Standard targets</a></li>
<li><a href="#org88b816e">2.2. Filesystem Hierarchy Standard (FHS)</a></li>
<li><a href="#org3fb01f4">2.3. Standard variables</a></li>
</ul>
</li>
<li><a href="#org6164e44">3. Writing portable Makefiles</a>
<ul>
<li><a href="#orgf916149">3.1. What you will lose by sticking to the POSIX standard</a></li>
<li><a href="#org21be2a7">3.2. Rules that will make everything simpler</a></li>
</ul>
</li>
<li><a href="#org877ed5b">4. Automake basics</a></li>
<li><a href="#orgaee9423">5. Unit testing</a></li>
<li><a href="#org9f1260a">6. Creating a distributed tarball</a>
<ul>
<li><a href="#orgd4aa68c">6.1. Source distribution targets</a></li>
<li><a href="#org3709ea3">6.2. Maintainer mode</a></li>
</ul>
</li>
<li><a href="#org64adc2d">7. Using pkg-config</a></li>
</ul>
</div>
</div>
<p>
This page contains a tutorial on the usage <a href="http://www.gnu.org/software/automake/">GNU Automake</a>.  This is the
second part of the <a href="./index.html">Autotools tutorial</a>.
</p>

<div id="outline-container-orgbac552f" class="outline-2">
<h2 id="orgbac552f"><span class="section-number-2">1</span> Introduction</h2>
<div class="outline-text-2" id="text-1">
<p>
Using a simplified syntax, <b>Automake</b> produces functional Makefiles
which are consistent with the GNU coding standards. This implies that
the Makefiles use standard build targets
(<code class="src src-bash">make install</code>, <code class="src src-bash">make clean</code>, <code class="src src-bash">make dist</code>,
&#x2026;) and standard installation paths (<code>/usr/bin</code>, <code>/usr/share/</code>,
<code>/usr/include</code>, <code>/usr/man</code>, &#x2026;). To avoid struggling too much with
<b>Automake</b>, it is important to understand the usual build, test and
install philosophies common to GNU projects, as well as the underlying
infrastructure managed by <b>Autotools</b>.
</p>


<div class="figure">
<p><img src="https://devmanual.gentoo.org/general-concepts/autotools/diagram.png" alt="diagram.png" />
</p>
<p><span class="figure-number">Figure 1: </span>Figure from <a href="https://devmanual.gentoo.org/general-concepts/autotools/index.html">The Basics of Autotools</a></p>
</div>

<p>
You have seen in the <b>Autoconf</b> tutorial how to write <code>configure.ac</code>
and <code>Makefile.in</code>.  Here, we introduce <b>Automake</b> which will produce
the <code>Makefile.in</code> from a high-level specification file <code>Makefile.am</code>.
The produced file will automatically add extra functionalities to the
Makefile, using standard target names.
</p>
</div>
</div>

<div id="outline-container-org5dbdef3" class="outline-2">
<h2 id="org5dbdef3"><span class="section-number-2">2</span> GNU standards</h2>
<div class="outline-text-2" id="text-2">
<p>
GNU standards are well known to users. If you use them, your users
will be grateful because it will avoid them to read your installation
instructions.
In addition, it will make the packaging of your code much simpler if
you want to make it available as as Linux distribution package
(<code>.deb</code>, <code>.rpm</code>, &#x2026;), or as a package for
<a href="https://brew.sh/">Homebrew</a>,
<a href="http://guix.gnu.org/">Guix</a>,
<a href="https://conda.io/">Conda</a>,
<a href="https://spack.io/">Spack</a>,
<a href="https://easybuild.io/">EasyBuild</a>, &#x2026;
</p>

<div class="seealso">
<ul class="org-ul">
<li><a href="https://www.gnu.org/prep/standards/html_node/index.html">GNU coding standards</a></li>
<li><a href="https://coderwall.com/p/urkybq/how-to-create-debian-package-from-source">How to create Debian package from source</a></li>
<li><a href="https://rpm-packaging-guide.github.io/">RPM packaging guide</a></li>
</ul>

</div>
</div>

<div id="outline-container-orgfc5a5d0" class="outline-3">
<h3 id="orgfc5a5d0"><span class="section-number-3">2.1</span> Standard targets</h3>
<div class="outline-text-3" id="text-2-1">
<p>
The GNU standards define standard target names to be included in
Makefiles, such that the behavior of make becomes uniform among
multiple packages. Here is a short list of the main targets:
</p>

<dl class="org-dl">
<dt><code>make all</code></dt><dd>Builds all the targets sufficient to declare the package built.</dd>
<dt><code>make clean</code></dt><dd>Removes all derived files.</dd>
<dt><code>make check</code></dt><dd>Runs unit tests provided by the package.</dd>
<dt><code>make install</code></dt><dd>Installs the package</dd>
<dt><code>make uninstall</code></dt><dd>Uninstalls the package</dd>
<dt><code>make html</code></dt><dd>Builds the documentation in HTML format</dd>
<dt><code>make check</code></dt><dd>Performs self-tests</dd>
</dl>

<div class="seealso">
<ul class="org-ul">
<li><a href="https://www.gnu.org/prep/standards/html_node/Standard-Targets.html#Standard-Targets">Standard targets for users</a></li>
</ul>

</div>
</div>
</div>

<div id="outline-container-org88b816e" class="outline-3">
<h3 id="org88b816e"><span class="section-number-3">2.2</span> Filesystem Hierarchy Standard (FHS)</h3>
<div class="outline-text-3" id="text-2-2">
<p>
The FHS defines the directory structure and contents in Linux
distributions. All Unix-like systems follow the FHS, which defines
standard places for files like:
</p>

<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-left" />

<col  class="org-left" />
</colgroup>
<thead>
<tr>
<th scope="col" class="org-left">Path</th>
<th scope="col" class="org-left">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left"><code>/bin</code></td>
<td class="org-left">Essential binaries</td>
</tr>

<tr>
<td class="org-left"><code>/lib</code></td>
<td class="org-left">Essential libraries</td>
</tr>

<tr>
<td class="org-left"><code>/etc</code></td>
<td class="org-left">Editable Text Configuration files</td>
</tr>

<tr>
<td class="org-left"><code>/sbin</code></td>
<td class="org-left">Essential system binaries</td>
</tr>

<tr>
<td class="org-left"><code>/tmp</code></td>
<td class="org-left">Directory for temporary files</td>
</tr>

<tr>
<td class="org-left"><code>/usr</code></td>
<td class="org-left">Secondary hierarchy for user data</td>
</tr>

<tr>
<td class="org-left"><code>/usr/bin</code></td>
<td class="org-left">Non-essential binaries</td>
</tr>

<tr>
<td class="org-left"><code>/usr/lib</code></td>
<td class="org-left">Libraries for non-essential binaries</td>
</tr>

<tr>
<td class="org-left"><code>/usr/include</code></td>
<td class="org-left">Standard include files</td>
</tr>

<tr>
<td class="org-left"><code>/usr/local</code></td>
<td class="org-left">Tertiary hierarchy for local data</td>
</tr>
</tbody>
</table>

<div class="seealso">
<ul class="org-ul">
<li><a href="https://en.wikipedia.org/wiki/Filesystem_Hierarchy_Standard">FHS on Wikipedia</a></li>
<li><a href="https://refspecs.linuxfoundation.org/FHS_3.0/fhs-3.0.pdf">FHS specification</a></li>
</ul>

</div>
</div>
</div>

<div id="outline-container-org3fb01f4" class="outline-3">
<h3 id="org3fb01f4"><span class="section-number-3">2.3</span> Standard variables</h3>
<div class="outline-text-3" id="text-2-3">
<p>
Installation directories are named by standard variables, so it is
easy to install the package in a non-standard place.
The main variables are:
</p>

<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-left" />

<col  class="org-left" />

<col  class="org-left" />
</colgroup>
<thead>
<tr>
<th scope="col" class="org-left">Variable</th>
<th scope="col" class="org-left">Default</th>
<th scope="col" class="org-left">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left"><code>prefix</code></td>
<td class="org-left"><code>/usr/local</code></td>
<td class="org-left">Root of the hierarchy</td>
</tr>

<tr>
<td class="org-left"><code>bindir</code></td>
<td class="org-left"><code>/usr/local/bin</code></td>
<td class="org-left">Where to install the binaries</td>
</tr>

<tr>
<td class="org-left"><code>sysconfdir</code></td>
<td class="org-left"><code>/usr/local/etc</code></td>
<td class="org-left">Where to install configuration files</td>
</tr>

<tr>
<td class="org-left"><code>includedir</code></td>
<td class="org-left"><code>/usr/local/lib</code></td>
<td class="org-left">Where to install the libraries</td>
</tr>

<tr>
<td class="org-left"><code>includedir</code></td>
<td class="org-left"><code>/usr/local/include</code></td>
<td class="org-left">Where to install include files</td>
</tr>

<tr>
<td class="org-left"><code>docdir</code></td>
<td class="org-left"><code>/usr/local/share/doc/&lt;package&gt;</code></td>
<td class="org-left">Where to install the documentation</td>
</tr>

<tr>
<td class="org-left"><code>srcdir</code></td>
<td class="org-left">Set by <code>configure</code></td>
<td class="org-left">The directory of the sources being compiled</td>
</tr>
</tbody>
</table>

<p>
In the <code>Makefile.in</code>, these variables may be used between <code>@@</code>
symbols, like <code>@@bindir@@</code> for instance.
</p>

<div class="seealso">
<ul class="org-ul">
<li><a href="https://www.gnu.org/prep/standards/html_node/Directory-Variables.html#Directory-Variables">Directory variables</a></li>
</ul>

</div>
</div>
</div>
</div>

<div id="outline-container-org6164e44" class="outline-2">
<h2 id="org6164e44"><span class="section-number-2">3</span> Writing portable Makefiles</h2>
<div class="outline-text-2" id="text-3">
<p>
The Makefiles produced by <b>Automake</b> are made to be portable among
Linux and Unix systems. Before diving into <b>Automake</b>, we will present
a few techniques to write portable Makefiles.
</p>

<p>
The most popular implementation of <code>make</code> is GNU Make. GNU Make is much more
evolved than the POSIX standard, so Makefiles designed for GNU Make are not
guaranteed to work with alternate implementations of <code>make</code>, such as BSD make for
instance. If you want your software to be <i>really</i> portable, you should stick to the
POSIX standard in your Makefile by including the line
</p>

<div class="org-src-container">
<pre class="src src-makefile">.POSIX
</pre>
</div>

<p>
at the top of your Makefile.
</p>
</div>

<div id="outline-container-orgf916149" class="outline-3">
<h3 id="orgf916149"><span class="section-number-3">3.1</span> What you will lose by sticking to the POSIX standard</h3>
<div class="outline-text-3" id="text-3-1">
<ul class="org-ul">
<li><p>
Pattern rules, such as
</p>

<div class="org-src-container">
<pre class="src src-makefile"><span style="color: #0000ff;">%_test.o</span>: %_test.c
        $(<span style="color: #a0522d;">CC</span>) $<span style="color: #008b8b;">&lt;</span> -o <span style="color: #0000ff;">$</span><span style="color: #008b8b;">@</span>
</pre>
</div></li>

<li>Special functions <code class="src src-makefile">$(wildcard *.c)</code>, <code class="src src-makefile">$(patsubst %.f, %.o, $(<span style="color: #a0522d;">SRC</span>))</code>, &#x2026;</li>
</ul>
</div>
</div>

<div id="outline-container-org21be2a7" class="outline-3">
<h3 id="org21be2a7"><span class="section-number-3">3.2</span> Rules that will make everything simpler</h3>
<div class="outline-text-3" id="text-3-2">
<ul class="org-ul">
<li>Don't use any other automatic variable than <code>$@</code> (the name of the current target)</li>
<li>Use <code class="src src-bash">/bin/sh</code> instead of <code class="src src-bash">/bin/bash</code></li>
<li>Don't put your compiled files (<code>.o</code>) in a separate location than the source files</li>
<li>Give up writing your Makefiles by hand. Write <b>scripts</b> (Bash, Python) to
write them for you.</li>
<li>Install <code>bmake</code> as an alternative to GNU make to check the portability of
your Makefiles.</li>
</ul>


<div class="seealso">
<ul class="org-ul">
<li><a href="http://gnu.ist.utl.pt/software/autoconf/manual/autoconf-2.57/html_chapter/autoconf_10.html">Portable shell programming</a></li>
<li><a href="https://www.oreilly.com/library/view/managing-projects-with/0596006101/ch07.html">Portable Makefiles</a></li>
<li><a href="https://www.gnu.org/savannah-checkouts/gnu/autoconf/manual/autoconf-2.70/html_node/Portable-Make.html#Portable-Make">Portable Make programming</a></li>
</ul>

</div>
</div>
</div>
</div>

<div id="outline-container-org877ed5b" class="outline-2">
<h2 id="org877ed5b"><span class="section-number-2">4</span> Automake basics</h2>
<div class="outline-text-2" id="text-4">
<p>
Automake reads the <code>Makefile.am</code> file and produces the <code>Makefile.in</code>
file. The produced file may contain thousands of lines, and is
guaranteed to have the basic functionalities (<code class="src src-bash">make all</code>,
<code class="src src-bash">make clean</code>, &#x2026;) in a portable Makefile.
<code>Makefile.am</code> contains regular <code>make</code> syntax, and the code it
contains will be inserted at the proper location in the <code>Makefil.in</code>
file. 
</p>
</div>
</div>

<div id="outline-container-orgaee9423" class="outline-2">
<h2 id="orgaee9423"><span class="section-number-2">5</span> Unit testing</h2>
<div class="outline-text-2" id="text-5">
<div class="exercise">
<p>
Provide a unit test for the current package which always succeeds,
and another one which always fails.
</p>

</div>
</div>
</div>

<div id="outline-container-org9f1260a" class="outline-2">
<h2 id="org9f1260a"><span class="section-number-2">6</span> Creating a distributed tarball</h2>
<div class="outline-text-2" id="text-6">
</div>
<div id="outline-container-orgd4aa68c" class="outline-3">
<h3 id="orgd4aa68c"><span class="section-number-3">6.1</span> Source distribution targets</h3>
<div class="outline-text-3" id="text-6-1">
<p>
<b>Automake</b> provides the <code>dist</code> and <code>distcheck</code> targets:
</p>

<div class="org-src-container">
<pre class="src src-bash">$ make dist
$ make distcheck
</pre>
</div>

<p>
<code class="src src-bash">make dist</code> creates a <code>.tar.gz</code> file which contains all the
files necessary to install the package: installation instructions,
<code>configure</code> script, source code, documentation, man pages, unit
tests, etc.
</p>
</div>
</div>

<div id="outline-container-org3709ea3" class="outline-3">
<h3 id="org3709ea3"><span class="section-number-3">6.2</span> Maintainer mode</h3>
<div class="outline-text-3" id="text-6-2">
<p>
There are two types of people who will try to compile the source
code:
</p>
<ol class="org-ol">
<li>The end-users having downloaded a tarball with sources</li>
<li>The developers of the code, who produce the source distribution
of the code</li>
</ol>

<p>
These two profiles should be differentiated, because their system
requirements are usually different. The first difference is that the
code developers will need to install <b>Autotools</b> as they will
produce the <code>configure</code> script, but <b>Autotools</b> will not be needed
by the end-users.
</p>

<p>
A more critical example is when complex Makefiles are produced by a
script. The script generating the Makefiles should be stored in the
version control system for developers, as opposed to the generated
Makefiles. For the end-user's point of view, only the generated
Makefiles are needed for the compilation of the sources, and the
script should not be present in the source distribution.
</p>

<p>
To handle these two types of profiles, <b>Autotools</b> provides the
<i>maintainer mode</i>. For instance, in maintainer mode the <code>configure</code>
script is re-generated when <code>configure.ac</code> has changed, as opposed
to standard mode. All these rules are activated in the generated
Makefiles by running
</p>

<div class="org-src-container">
<pre class="src src-bash">./configure --enable-maintainer-mode
</pre>
</div>

<div class="seealso">
<ul class="org-ul">
<li><a href="https://autotools.io/automake/maintainer.html">Maintainer mode and the <code>missing</code> script</a></li>
</ul>

</div>
</div>
</div>
</div>

<div id="outline-container-org64adc2d" class="outline-2">
<h2 id="org64adc2d"><span class="section-number-2">7</span> Using pkg-config</h2>
<div class="outline-text-2" id="text-7">
<p>
When your software depends on external libraries and you try to
compile it on an unknown system, you need to figure out what are the
correct flags to access the include files of the library and how to
link it. `configure` will try to find the libraries in the standard
locations, but if the configuration is a bit exotic, this will
require some extra knowledge.
</p>

<p>
At the moment you install a library on a a system, you have all the
knowledge required to use this library in other software: what
compiler options to add. All this information can be saved in a
file with the suffix <code>.pc</code> stored in a standard location such as
<code>/usr/lib/pkgconfig</code>, and this information can be retrieved later on
with the <code>pkg-config</code> command.
</p>

<p>
Let's assume you have compiled and installed the <i>QMCkl</i>
library. The library will produce the system-specific file
<code>/usr/local/lib/pkgconfig/qmckl.pc</code>:
</p>

<div class="org-src-container">
<pre class="src src-bash"><span style="color: #a0522d;">prefix</span>=/usr/local
<span style="color: #a0522d;">exec_prefix</span>=${<span style="color: #a0522d;">prefix</span>}
<span style="color: #a0522d;">includedir</span>=${<span style="color: #a0522d;">prefix</span>}/include
<span style="color: #a0522d;">libdir</span>=${<span style="color: #a0522d;">exec_prefix</span>}/lib


Name: qmckl
Description: Quantum Monte Carlo kernel library
URL: https://github.com/trex-coe/qmckl
Version: 0.1.1
Cflags:  -I${<span style="color: #a0522d;">includedir</span>}
Libs: -L${<span style="color: #a0522d;">libdir</span>} -lqmckl
Libs.private:  -L/home/scemama/TREX/trexio/_install/lib -L/usr/lib/x86_64-linux-gnu/hdf5/serial -ltrexio -lhdf5 -lpthread -lm 
</pre>
</div>

<p>
This file tells you that you need to include the flag
<code>-I/usr/local/include</code> to the C preprocessor (the <code>CPPFLAGS</code>
variable), and the <code>-L/usr/local/lib -lqmckl</code> flag at the link stage
(the <code>LDFLAGS</code> variable) if you want to use the dynamically linked library.
</p>

<p>
This information can be accessed using the <code>pkg-config</code> command:
</p>
<div class="org-src-container">
<pre class="src src-bash">$ pkg-config --cflags qmckl
-I/usr/local/include/

$ pkg-config --libs qmckl
-L/usr/local/lib -lqmckl
</pre>
</div>

<p>
In your <code>configure.ac</code> file, you can simply use
</p>

<div class="org-src-container">
<pre class="src src-bash"><span style="color: #0000ff;">PKG_CHECK_MODULES</span>([qmckl])
<span style="color: #a0522d;">CFLAGS</span>=<span style="color: #8b2252;">"${CFLAGS} `pkg-config --cflags qmckl`"</span>
<span style="color: #a0522d;">LDFLAGS</span>=<span style="color: #8b2252;">"${LDFLAGS} `pkg-config --libs qmckl`"</span>
</pre>
</div>

<p>
to include the appropriate flags. The <code>PKG_CHECK_MODULE</code> macro
will fail if pkg-config is not installed on the system, or if the
<code>qmckl.pc</code> file is not found.
</p>

<div class="tip">
<p>
The pkg-config files are searched in the directories defined by the
<code class="src src-bash">PKG_CONFIG_PATH</code> environment variable.
</p>

</div>

<div class="seealso">
<ul class="org-ul">
<li><a href="https://people.freedesktop.org/~dbn/pkg-config-guide.html">Guide to pkg-config</a></li>
<li><a href="https://autotools.io/pkgconfig/index.html">Dependency discovery — pkg-config</a></li>
</ul>

</div>
</div>
</div>
</div>
<div id="postamble" class="status">
<p class="author">Author: Evgeny Posenitskiy, Anthony Scemama</p>
<p class="date">Created: 2021-11-03 Wed 13:20</p>
<p class="validation"><a href="http://validator.w3.org/check?uri=referer">Validate</a></p>
</div>
</body>
</html>
