<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
<head>
<!-- 2021-11-08 Mon 19:34 -->
<meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Part I: Autoconf</title>
<meta name="generator" content="Org mode" />
<meta name="author" content="Evgeny Posenitskiy, Anthony Scemama" />
<style type="text/css">
 <!--/*--><![CDATA[/*><!--*/
  .title  { text-align: center;
             margin-bottom: .2em; }
  .subtitle { text-align: center;
              font-size: medium;
              font-weight: bold;
              margin-top:0; }
  .todo   { font-family: monospace; color: red; }
  .done   { font-family: monospace; color: green; }
  .priority { font-family: monospace; color: orange; }
  .tag    { background-color: #eee; font-family: monospace;
            padding: 2px; font-size: 80%; font-weight: normal; }
  .timestamp { color: #bebebe; }
  .timestamp-kwd { color: #5f9ea0; }
  .org-right  { margin-left: auto; margin-right: 0px;  text-align: right; }
  .org-left   { margin-left: 0px;  margin-right: auto; text-align: left; }
  .org-center { margin-left: auto; margin-right: auto; text-align: center; }
  .underline { text-decoration: underline; }
  #postamble p, #preamble p { font-size: 90%; margin: .2em; }
  p.verse { margin-left: 3%; }
  pre {
    border: 1px solid #ccc;
    box-shadow: 3px 3px 3px #eee;
    padding: 8pt;
    font-family: monospace;
    overflow: auto;
    margin: 1.2em;
  }
  pre.src {
    position: relative;
    overflow: visible;
    padding-top: 1.2em;
  }
  pre.src:before {
    display: none;
    position: absolute;
    background-color: white;
    top: -10px;
    right: 10px;
    padding: 3px;
    border: 1px solid black;
  }
  pre.src:hover:before { display: inline;}
  /* Languages per Org manual */
  pre.src-asymptote:before { content: 'Asymptote'; }
  pre.src-awk:before { content: 'Awk'; }
  pre.src-C:before { content: 'C'; }
  /* pre.src-C++ doesn't work in CSS */
  pre.src-clojure:before { content: 'Clojure'; }
  pre.src-css:before { content: 'CSS'; }
  pre.src-D:before { content: 'D'; }
  pre.src-ditaa:before { content: 'ditaa'; }
  pre.src-dot:before { content: 'Graphviz'; }
  pre.src-calc:before { content: 'Emacs Calc'; }
  pre.src-emacs-lisp:before { content: 'Emacs Lisp'; }
  pre.src-fortran:before { content: 'Fortran'; }
  pre.src-gnuplot:before { content: 'gnuplot'; }
  pre.src-haskell:before { content: 'Haskell'; }
  pre.src-hledger:before { content: 'hledger'; }
  pre.src-java:before { content: 'Java'; }
  pre.src-js:before { content: 'Javascript'; }
  pre.src-latex:before { content: 'LaTeX'; }
  pre.src-ledger:before { content: 'Ledger'; }
  pre.src-lisp:before { content: 'Lisp'; }
  pre.src-lilypond:before { content: 'Lilypond'; }
  pre.src-lua:before { content: 'Lua'; }
  pre.src-matlab:before { content: 'MATLAB'; }
  pre.src-mscgen:before { content: 'Mscgen'; }
  pre.src-ocaml:before { content: 'Objective Caml'; }
  pre.src-octave:before { content: 'Octave'; }
  pre.src-org:before { content: 'Org mode'; }
  pre.src-oz:before { content: 'OZ'; }
  pre.src-plantuml:before { content: 'Plantuml'; }
  pre.src-processing:before { content: 'Processing.js'; }
  pre.src-python:before { content: 'Python'; }
  pre.src-R:before { content: 'R'; }
  pre.src-ruby:before { content: 'Ruby'; }
  pre.src-sass:before { content: 'Sass'; }
  pre.src-scheme:before { content: 'Scheme'; }
  pre.src-screen:before { content: 'Gnu Screen'; }
  pre.src-sed:before { content: 'Sed'; }
  pre.src-sh:before { content: 'shell'; }
  pre.src-sql:before { content: 'SQL'; }
  pre.src-sqlite:before { content: 'SQLite'; }
  /* additional languages in org.el's org-babel-load-languages alist */
  pre.src-forth:before { content: 'Forth'; }
  pre.src-io:before { content: 'IO'; }
  pre.src-J:before { content: 'J'; }
  pre.src-makefile:before { content: 'Makefile'; }
  pre.src-maxima:before { content: 'Maxima'; }
  pre.src-perl:before { content: 'Perl'; }
  pre.src-picolisp:before { content: 'Pico Lisp'; }
  pre.src-scala:before { content: 'Scala'; }
  pre.src-shell:before { content: 'Shell Script'; }
  pre.src-ebnf2ps:before { content: 'ebfn2ps'; }
  /* additional language identifiers per "defun org-babel-execute"
       in ob-*.el */
  pre.src-cpp:before  { content: 'C++'; }
  pre.src-abc:before  { content: 'ABC'; }
  pre.src-coq:before  { content: 'Coq'; }
  pre.src-groovy:before  { content: 'Groovy'; }
  /* additional language identifiers from org-babel-shell-names in
     ob-shell.el: ob-shell is the only babel language using a lambda to put
     the execution function name together. */
  pre.src-bash:before  { content: 'bash'; }
  pre.src-csh:before  { content: 'csh'; }
  pre.src-ash:before  { content: 'ash'; }
  pre.src-dash:before  { content: 'dash'; }
  pre.src-ksh:before  { content: 'ksh'; }
  pre.src-mksh:before  { content: 'mksh'; }
  pre.src-posh:before  { content: 'posh'; }
  /* Additional Emacs modes also supported by the LaTeX listings package */
  pre.src-ada:before { content: 'Ada'; }
  pre.src-asm:before { content: 'Assembler'; }
  pre.src-caml:before { content: 'Caml'; }
  pre.src-delphi:before { content: 'Delphi'; }
  pre.src-html:before { content: 'HTML'; }
  pre.src-idl:before { content: 'IDL'; }
  pre.src-mercury:before { content: 'Mercury'; }
  pre.src-metapost:before { content: 'MetaPost'; }
  pre.src-modula-2:before { content: 'Modula-2'; }
  pre.src-pascal:before { content: 'Pascal'; }
  pre.src-ps:before { content: 'PostScript'; }
  pre.src-prolog:before { content: 'Prolog'; }
  pre.src-simula:before { content: 'Simula'; }
  pre.src-tcl:before { content: 'tcl'; }
  pre.src-tex:before { content: 'TeX'; }
  pre.src-plain-tex:before { content: 'Plain TeX'; }
  pre.src-verilog:before { content: 'Verilog'; }
  pre.src-vhdl:before { content: 'VHDL'; }
  pre.src-xml:before { content: 'XML'; }
  pre.src-nxml:before { content: 'XML'; }
  /* add a generic configuration mode; LaTeX export needs an additional
     (add-to-list 'org-latex-listings-langs '(conf " ")) in .emacs */
  pre.src-conf:before { content: 'Configuration File'; }

  table { border-collapse:collapse; }
  caption.t-above { caption-side: top; }
  caption.t-bottom { caption-side: bottom; }
  td, th { vertical-align:top;  }
  th.org-right  { text-align: center;  }
  th.org-left   { text-align: center;   }
  th.org-center { text-align: center; }
  td.org-right  { text-align: right;  }
  td.org-left   { text-align: left;   }
  td.org-center { text-align: center; }
  dt { font-weight: bold; }
  .footpara { display: inline; }
  .footdef  { margin-bottom: 1em; }
  .figure { padding: 1em; }
  .figure p { text-align: center; }
  .inlinetask {
    padding: 10px;
    border: 2px solid gray;
    margin: 10px;
    background: #ffffcc;
  }
  #org-div-home-and-up
   { text-align: right; font-size: 70%; white-space: nowrap; }
  textarea { overflow-x: auto; }
  .linenr { font-size: smaller }
  .code-highlighted { background-color: #ffff00; }
  .org-info-js_info-navigation { border-style: none; }
  #org-info-js_console-label
    { font-size: 10px; font-weight: bold; white-space: nowrap; }
  .org-info-js_search-highlight
    { background-color: #ffff00; color: #000000; font-weight: bold; }
  .org-svg { width: 90%; }
  /*]]>*/-->
</style>
<link rel="stylesheet" type="text/css" href="org-html-themes/src/readtheorg_theme/css/htmlize.css"/>
<link rel="stylesheet" type="text/css" href="org-html-themes/src/readtheorg_theme/css/readtheorg.css"/>
<script type="text/javascript" src="org-html-themes/src/lib/js/jquery.min.js"></script>
<script type="text/javascript" src="org-html-themes/src/lib/js/bootstrap.min.js"></script>
<script type="text/javascript" src="org-html-themes/src/lib/js/jquery.stickytableheaders.min.js"></script>
<script type="text/javascript" src="org-html-themes/src/readtheorg_theme/js/readtheorg.js"></script>
<script type="text/javascript">
/*
@licstart  The following is the entire license notice for the
JavaScript code in this tag.

Copyright (C) 2012-2019 Free Software Foundation, Inc.

The JavaScript code in this tag is free software: you can
redistribute it and/or modify it under the terms of the GNU
General Public License (GNU GPL) as published by the Free Software
Foundation, either version 3 of the License, or (at your option)
any later version.  The code is distributed WITHOUT ANY WARRANTY;
without even the implied warranty of MERCHANTABILITY or FITNESS
FOR A PARTICULAR PURPOSE.  See the GNU GPL for more details.

As additional permission under GNU GPL version 3 section 7, you
may distribute non-source (e.g., minimized or compacted) forms of
that code without the copy of the GNU GPL normally required by
section 4, provided you include this license notice and a URL
through which recipients can access the Corresponding Source.


@licend  The above is the entire license notice
for the JavaScript code in this tag.
*/
<!--/*--><![CDATA[/*><!--*/
 function CodeHighlightOn(elem, id)
 {
   var target = document.getElementById(id);
   if(null != target) {
     elem.cacheClassElem = elem.className;
     elem.cacheClassTarget = target.className;
     target.className = "code-highlighted";
     elem.className   = "code-highlighted";
   }
 }
 function CodeHighlightOff(elem, id)
 {
   var target = document.getElementById(id);
   if(elem.cacheClassElem)
     elem.className = elem.cacheClassElem;
   if(elem.cacheClassTarget)
     target.className = elem.cacheClassTarget;
 }
/*]]>*///-->
</script>
</head>
<body>
<div id="org-div-home-and-up">
 <a accesskey="h" href="index.html"> UP </a>
 |
 <a accesskey="H" href="index.html"> HOME </a>
</div><div id="content">
<h1 class="title">Part I: Autoconf</h1>
<div id="table-of-contents">
<h2>Table of Contents</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="#orgb4f9e4b">1. Introduction</a></li>
<li><a href="#orgfea9648">2. Demo project</a></li>
<li><a href="#org474d93b">3. Makefile</a></li>
<li><a href="#org40c05fb">4. Autoconf</a></li>
<li><a href="#orgefc22a2">5. Detecting external dependencies</a></li>
<li><a href="#org8575bed">6. pkg-config</a></li>
<li><a href="#org32c4db1">7. Conclusion</a></li>
</ul>
</div>
</div>
<p>
This page contains the <a href="https://www.gnu.org/software/autoconf/">GNU Autoconf</a> tutorial, which is the first part of the <a href="./index.html">Autotools tutorial</a>.
</p>

<div id="outline-container-orgb4f9e4b" class="outline-2">
<h2 id="orgb4f9e4b"><span class="section-number-2">1</span> Introduction</h2>
<div class="outline-text-2" id="text-1">
<p>
Building software on different platforms is a challenging task.
Re-building it a few years later is even more challenging.
</p>

<p>
Things get more complicated when the project introduces external dependencies
(e.g. libraries that are installed independently and outside of the source tree).
Such dependencies can be located with some built-in tools like <code>pkg-config</code>.
One could then modify the compilation flags to explicitly include installation paths, thus making the code compile on the current machine.
This approach works fine as long as the code has to be compiled only locally and as long as the dependency is not moved to a different directory.
However, the installation paths are likely to be different on another machine and the aforementioned build procedure might break.
</p>

<p>
<b>Autoconf</b> was designed to solve this problem by creating
configuration scripts that work correctly on most systems, even on
systems not initially considered by the developer. As opposed to
<code>CMake</code>, all the burden is put on the shoulders of the developer to
make the life simpler for the end user.
</p>
</div>
</div>

<div id="outline-container-orgfea9648" class="outline-2">
<h2 id="orgfea9648"><span class="section-number-2">2</span> Demo project</h2>
<div class="outline-text-2" id="text-2">
<p>
In this tutorial, we will learn how to configure a particular project using <b>Autoconf</b>.
This project consists of several <code>C++</code> source files, which are compiled into a single program using custom <code>Makefile</code>.
It is worth mentioning that you don't need to be a <code>C++</code> programmer to be able to do this tutorial.
We will learn how to configure and test the <code>C++</code> compiler before building the project.
The source files depend on the <a href="https://portal.hdfgroup.org/display/HDF5/HDF5">HDF5 library</a>, which is a good example of external dependency.
HDF5 is a binary file format, which is designed for high-performance data input/output.
We will learn how to automatically locate the HDF5 library using macros.
</p>

<p>
Below is a source tree of our project. Header and source files can be found in the <code>include/</code> and <code>src/</code> directories, respectively.
The <code>tests/</code> directory contains the <code>test_h5.cpp</code> and <code>dataset.hdf5</code> files needed to test compilation of the aforementioned source codes.
</p>

<p>
For this tutorial, the contents of the source and header files are not important.
However, it is worth mentioning that they depend on the HDF5 library, which is not included in the source tree.
Our goal is to demonstrate how cumbersome configuration/compilation steps can be facilitated by the use of <b>Autoconf</b>.
</p>

<div class="org-src-container">
<pre class="src src-text">Sherman-Morrison/
&#9500;&#9472; bin/
&#9474;  &#9500;&#9472; .gitignore
&#9500;&#9472; include/
&#9474;  &#9500;&#9472; Helpers.hpp
&#9474;  &#9500;&#9472; SMWB.hpp
&#9474;  &#9500;&#9472; SM_Maroni.hpp
&#9474;  &#9500;&#9472; SM_Standard.hpp
&#9474;  &#9500;&#9472; Woodbury.hpp
&#9500;&#9472; src/
&#9474;  &#9500;&#9472; Helpers.cpp
&#9474;  &#9500;&#9472; SMWB.cpp
&#9474;  &#9500;&#9472; SM_Maroni.cpp
&#9474;  &#9500;&#9472; SM_Standard.cpp
&#9474;  &#9500;&#9472; Woodbury.cpp
&#9500;&#9472; tests/
&#9474;  &#9500;&#9472; test_h5.cpp
&#9474;  &#9500;&#9472; dataset.hdf5
&#9500;&#9472; LICENSE
&#9500;&#9472; Makefile
&#9500;&#9472; README.md
&#9500;&#9472; .gitignore
</pre>
</div>

<p>
The source code comes from the <a href="https://github.com/TREX-CoE/Sherman-Morrison">Sherman-Morrison GitHub repository</a> of the TREX-CoE.
It is distributed under BSD 3-Clause License. 
</p>
</div>
</div>

<div id="outline-container-org474d93b" class="outline-2">
<h2 id="org474d93b"><span class="section-number-2">3</span> Makefile</h2>
<div class="outline-text-2" id="text-3">
<p>
Below is the <code>Makefile</code> of our project:
</p>

<div class="org-src-container">
<pre class="src src-makefile">## <span style="color: #b22222;">Specify the C++ compiler as well as preprocessor, compiler and linking flags</span>
<span style="color: #a0522d;">CXX</span>      = g++
<span style="color: #a0522d;">CXXFLAGS</span> = -g -O2 -std=c++11
<span style="color: #a0522d;">CPPFLAGS</span> = -I/usr/include -I/usr/include/hdf5/serial  -I./include/
<span style="color: #a0522d;">LIBS</span>     = -lhdf5_hl -lhdf5  -lpthread -lsz -lz -ldl -lm  -lhdf5_cpp
<span style="color: #a0522d;">LDFLAGS</span>  = -L/usr/lib/x86_64-linux-gnu/hdf5/serial

## <span style="color: #b22222;">Directory structure</span>
<span style="color: #a0522d;">SRC_DIR</span> := src
<span style="color: #a0522d;">TST_DIR</span> := tests
<span style="color: #a0522d;">INC_DIR</span> := include
<span style="color: #a0522d;">BIN_DIR</span> := bin

<span style="color: #a0522d;">EXEC</span>    := $(<span style="color: #a0522d;">BIN_DIR</span>)/test_h5

## <span style="color: #b22222;">Dependencies</span>
<span style="color: #a0522d;">DEPS_CXX</span> = $(<span style="color: #a0522d;">SRC_DIR</span>)/SM_Maponi.o \
           $(<span style="color: #a0522d;">SRC_DIR</span>)/SM_Standard.o \
           $(<span style="color: #a0522d;">SRC_DIR</span>)/Woodbury.o \
           $(<span style="color: #a0522d;">SRC_DIR</span>)/SMWB.o \
           $(<span style="color: #a0522d;">SRC_DIR</span>)/Helpers.o

## <span style="color: #b22222;">Build tagets</span>
<span style="color: #0000ff;">.PHONY</span>: all clean

<span style="color: #0000ff;">all</span>: $(<span style="color: #a0522d;">EXEC</span>)

<span style="color: #0000ff;">clean</span>:
        <span style="color: #228b22;">@</span>rm -rf -- $(<span style="color: #a0522d;">SRC_DIR</span>)/*.o $(<span style="color: #a0522d;">TST_DIR</span>)/*.o $(<span style="color: #a0522d;">EXEC</span>)

## <span style="color: #b22222;">Compiling dependencies</span>
<span style="color: #0000ff;">.SUFFIXES</span>: .cpp .o

## <span style="color: #b22222;">Linking</span>
<span style="color: #0000ff;">$(</span><span style="color: #0000ff;">BIN_DIR</span><span style="color: #0000ff;">)/test_h5</span>: $(<span style="color: #a0522d;">DEPS_CXX</span>) $(<span style="color: #a0522d;">TST_DIR</span>)/test_h5.o
        $(<span style="color: #a0522d;">CXX</span>) $(<span style="color: #a0522d;">CPPFLAGS</span>) $(<span style="color: #a0522d;">CXXFLAGS</span>) $(<span style="color: #a0522d;">TST_DIR</span>)/test_h5.o $(<span style="color: #a0522d;">DEPS_CXX</span>) -o $(<span style="color: #a0522d;">EXEC</span>) $(<span style="color: #a0522d;">LDFLAGS</span>) $(<span style="color: #a0522d;">LIBS</span>)
</pre>
</div>

<p>
Let's have a look at the following part of our <code>Makefile</code> 
(from now on we will only focus on the following lines):
</p>

<div class="org-src-container">
<pre class="src src-makefile"><span style="color: #a0522d;">CXX</span>      = g++
<span style="color: #a0522d;">CXXFLAGS</span> = -g -O2 -std=c++11
<span style="color: #a0522d;">CPPFLAGS</span> = -I/usr/include -I/usr/include/hdf5/serial  -I./include/
<span style="color: #a0522d;">LIBS</span>     = -lhdf5_hl -lhdf5  -lpthread -lsz -lz -ldl -lm  -lhdf5_cpp
<span style="color: #a0522d;">LDFLAGS</span>  = -L/usr/lib/x86_64-linux-gnu/hdf5/serial
</pre>
</div>

<div class="question">
<p>
What are advantages and disadvantages of specifying compiler flags as above?
</p>

</div>

<p>
Among other things, the crucial issue here is the portability of the hard-coded paths to HDF5 (see <code>CPPFLAGS</code> and <code>LDFLAGS</code>).
</p>

<p>
Let's execute <code>make</code> command and examine the output. 
Normally, you should get a lot of errors, which are impossible to debug. So what happened? 
</p>

<p>
The compilation crashed due to several issues. 
One of them is that the aforementioned <code>Makefile</code> was adapted for one single machine.
Another issues comes from the fact that compiler flags are overwritten in <code>Makefile</code> instead of being appended to the existing ones.
It means that even if the current environment (e.g. the one created with <code>conda</code>) did some smart job 
and pre-set some compiler options, this information is still lost.
</p>

<p>
Let's append to the existing flags instead of overwriting them.
For this we will use <code>+=</code> syntax of Makefile.
</p>

<div class="org-src-container">
<pre class="src src-makefile"><span style="color: #a0522d;">CXX</span>       = g++
<span style="color: #a0522d;">CXXFLAGS</span> += -std=c++11
<span style="color: #a0522d;">CPPFLAGS</span> += -I./include/
<span style="color: #a0522d;">LIBS</span>     += -lhdf5 -lhdf5_cpp -lz
<span style="color: #a0522d;">LDFLAGS</span>  += -L/home/user/.conda/envs/autotools/lib
</pre>
</div>

<p>
If we now run <code>make</code> command the output may look like this:
</p>

<pre class="example">
$ make

g++ -fPIC -isystem /home/user/.conda/envs/autotools/include -std=c++11   -I./include/  -c -o src/SM_Maponi.o src/SM_Maponi.cpp
g++ -fPIC -isystem /home/user/.conda/envs/autotools/include -std=c++11   -I./include/  -c -o src/SM_Standard.o src/SM_Standard.cpp
g++ -fPIC -isystem /home/user/.conda/envs/autotools/include -std=c++11   -I./include/  -c -o src/Woodbury.o src/Woodbury.cpp
g++ -fPIC -isystem /home/user/.conda/envs/autotools/include -std=c++11   -I./include/  -c -o src/SMWB.o src/SMWB.cpp
g++ -fPIC -isystem /home/user/.conda/envs/autotools/include -std=c++11   -I./include/  -c -o src/Helpers.o src/Helpers.cpp
g++ -fPIC -isystem /home/user/.conda/envs/autotools/include -std=c++11   -I./include/  -c -o tests/test_h5.o tests/test_h5.cpp
g++  -I./include/ -fPIC -isystem /home/user/.conda/envs/autotools/include -std=c++11 tests/test_h5.o src/SM_Maponi.o src/SM_Standard.o src/Woodbury.o src/SMWB.o src/Helpers.o -o bin/test_h5  -L/home/user/.conda/envs/autotools/lib -lhdf5 -lhdf5_cpp -lz
</pre>

<p>
So it works.
</p>

<div class="question">
<p>
What is going to happen when you try to use the updated <code>Makefile</code> outside of the <code>conda</code> environment?
</p>

</div>

<p>
Unfortunately, our solution does not resolve the portability issue.
In this example, we demonstrated that defining compiler flags is challenging, 
especially for programs with external dependencies.
</p>

<p>
Would it be better if we could automate this process? 
Well, this is where <b><b>Autoconf</b></b> comes into play.
</p>
</div>
</div>

<div id="outline-container-org40c05fb" class="outline-2">
<h2 id="org40c05fb"><span class="section-number-2">4</span> Autoconf</h2>
<div class="outline-text-2" id="text-4">
<p>
In this section, we will talk about several files:
</p>

<ul class="org-ul">
<li><code>configure.ac</code></li>
<li><code>configure</code></li>
<li><code>Makefile.in</code></li>
<li><code>Makefile</code></li>
</ul>

<div class="tip">
<p>
The ultimate goal of the <b>Autoconf</b> is to produce the <code>configure</code> shell script based on the <code>configure.ac</code> file.
The <code>configure</code> script then detects the <code>Makefile.in</code> file and replaces some variables there to produce
the final <code>Makefile</code>, which is used to build a project.
</p>

</div>


<div class="figure">
<p><img src="https://devmanual.gentoo.org/general-concepts/autotools/diagram.png" alt="diagram.png" />
</p>
<p><span class="figure-number">Figure 1: </span>Figure from <a href="https://devmanual.gentoo.org/general-concepts/autotools/index.html">The Basics of Autotools</a></p>
</div>


<p>
This might be confusing at the beginning.
Let's create the simplest <code>configure.ac</code> file for our project with the following contents:
</p>

<div class="org-src-container">
<pre class="src src-makefile">#                                               <span style="color: #b22222;">-*- Autoconf -*-</span>
# <span style="color: #b22222;">Process this file with autoconf to produce a configure script.</span>

# <span style="color: #b22222;">Initialize autoconf</span>
AC_INIT([sherman-morrison], [0.0.1], [])

AC_OUTPUT
</pre>
</div>

<p>
Here we provided the name of our project <code>[sherman-morrison]</code> and the current version <code>[0.0.1]</code> to the <code>AC_INIT</code> macro.
These are now stored in the <code>$PACKAGE_NAME</code> and <code>$PACKAGE_VERSION</code> variables, respectively.
We will not cover the details of the M4 syntax that is used internally by the Autoconf.
For more information, see the <a href="https://www.gnu.org/software/autoconf/manual/autoconf-2.69/html_node/index.html">Autoconf documentation page</a>.
</p>

<div class="tip">
<p>
Most of the built-in <b>Autoconf</b> macros start with the <code>AC_</code> prefix.
</p>

</div>

<p>
We know that the source code is written in <code>C++</code> programming language (it can also be guessed from the <code>.cpp</code> extension).
Thus, we would like the <b>Autoconf</b> to find and possibly run some checks
using the <code>C++</code> compiler that is available on the current machine.
</p>

<p>
Let's add a few additional macros for that and examine their output:
</p>

<div class="org-src-container">
<pre class="src src-makefile">#                                               <span style="color: #b22222;">-*- Autoconf -*-</span>
# <span style="color: #b22222;">Process this file with autoconf to produce a configure script.</span>

# <span style="color: #b22222;">Initialize autoconf</span>
AC_INIT([sherman-morrison], [0.0.1], [])

# <span style="color: #b22222;">do the tests with C++ flags</span>
AC_LANG(C++)
# <span style="color: #b22222;">search for the C++ compiler</span>
AC_PROG_CXX
# <span style="color: #b22222;">check if the C++ compiler accepts -c and -o simultaneously</span>
AC_PROG_CXX_C_O

AC_OUTPUT

echo \
<span style="color: #8b2252;">"-------------------------------------------------</span>

<span style="color: #8b2252;">${</span><span style="color: #a0522d;">PACKAGE_NAME</span><span style="color: #8b2252;">} Version ${</span><span style="color: #a0522d;">PACKAGE_VERSION</span><span style="color: #8b2252;">}</span>

<span style="color: #8b2252;">CXX ...........:  ${</span><span style="color: #a0522d;">CXX</span><span style="color: #8b2252;">}</span>
<span style="color: #8b2252;">CXXFLAGS ......:  ${</span><span style="color: #a0522d;">CXXFLAGS</span><span style="color: #8b2252;">}</span>

<span style="color: #8b2252;">--------------------------------------------------"</span>
</pre>
</div>

<p>
The contents of the current directory should be as follows:
</p>

<pre class="example">
bin/  configure.ac  include/  LICENSE  Makefile  README.md  src/  tests/
</pre>

<p>
Now run <code>autoreconf</code> command in your terminal and examine the directory again.
After succesfull execution, a <code>configure</code> shell script should appear.
</p>

<div class="tip">
<p>
If you want to see what <code>autoreconf</code> does, use the <code>-v</code> option.
</p>

</div>

<p>
Let's run it by calling <code>./configure</code>.
Several checks have been performed by <b>Autoconf</b> and in the end one might get the following
(the <code>CXX</code> output will be different on your machine):
</p>

<pre class="example">
-------------------------------------------------

sherman-morrison Version 0.0.1

CXX ...........:  /home/user/.conda/envs/autotools/bin/x86_64-conda-linux-gnu-c++
CXXFLAGS ......:  -fPIC -isystem ${CONDA_PREFIX}/include

--------------------------------------------------
</pre>

<div class="tip">
<p>
<code>configure</code> produces a file named <code>config.log</code> which contains a log
of all the tests that were run. 
</p>

</div>

<p>
In the example above, the <code>configure</code> script has detected the GNU <code>C++</code> compiler and expanded the
<code>${CXX}</code> variable with the corresponding name.
</p>

<p>
From now on we will focus mainly on <code>$</code>-prefixed variables and calls to the <b>Autoconf</b> macros.
</p>

<div class="tip">
<p>
Whenever you make a change in the <code>configure.ac</code> file, do not forget to
execute <code>autoreconf -i</code> to update the generated <code>configure</code> script.
</p>

</div>

<p>
The <code>configure</code> script can also define its own variables (e.g. <code>$PACKAGE_NAME</code> above) and pass them to other files.
To benefit from the previously detected <code>C++</code> compiler and its flags, let's propagate them to <code>Makefile</code>.
</p>

<p>
This requires 2 actions:
</p>

<ul class="org-ul">
<li>Move <code>Makefile</code> to <code>Makefile.in</code> (this is the standard naming convention in <b>Autotools</b>) and replace the hard-coded variables with the ones defined by the <code>configure</code> script. For demonstration purposes, we only replace <code>CXX</code> and <code>CXXFLAGS</code> at the moment.</li>
<li>Indicate to <b>Autoconf</b> that producing <code>Makefile</code> is now its responsibility (due to the variables that will be substituted by <code>./configure</code> call). This can be achieved by adding <code>AC_CONFIG_FILES([Makefile])</code>.</li>
</ul>

<p>
<code>configure.ac</code>:
</p>
<div class="org-src-container">
<pre class="src src-makefile">#                                               <span style="color: #b22222;">-*- Autoconf -*-</span>
# <span style="color: #b22222;">Process this file with autoconf to produce a configure script.</span>

#<span style="color: #b22222;">initialize autoconf</span>
AC_INIT([sherman-morrison], [0.0.1], [])

# <span style="color: #b22222;">do the tests with C++ flags</span>
AC_LANG(C++)
# <span style="color: #b22222;">search for the C++ compiler</span>
AC_PROG_CXX
# <span style="color: #b22222;">check if the C++ compiler accepts -c and -o simultaneously</span>
AC_PROG_CXX_C_O

AC_CONFIG_FILES([Makefile])

AC_OUTPUT

echo \
<span style="color: #8b2252;">"-------------------------------------------------</span>

<span style="color: #8b2252;">${</span><span style="color: #a0522d;">PACKAGE_NAME</span><span style="color: #8b2252;">} Version ${</span><span style="color: #a0522d;">PACKAGE_VERSION</span><span style="color: #8b2252;">}</span>

<span style="color: #8b2252;">CXX ...........:  ${</span><span style="color: #a0522d;">CXX</span><span style="color: #8b2252;">}</span>
<span style="color: #8b2252;">CXXFLAGS ......:  ${</span><span style="color: #a0522d;">CXXFLAGS</span><span style="color: #8b2252;">}</span>

<span style="color: #8b2252;">--------------------------------------------------"</span>
</pre>
</div>

<p>
<code>Makefile.in</code> (remember, only the top part has to be changed):
</p>
<div class="org-src-container">
<pre class="src src-makefile"><span style="color: #a0522d;">CXX</span>       = @CXX@
<span style="color: #a0522d;">CXXFLAGS</span>  = @CXXFLAGS@
<span style="color: #a0522d;">CPPFLAGS</span> += -I./include/
<span style="color: #a0522d;">LIBS</span>     += -lhdf5 -lhdf5_cpp -lz
<span style="color: #a0522d;">LDFLAGS</span>  += -L/home/user/.conda/envs/autotools/lib
</pre>
</div>

<div class="tip">
<p>
Variables in between <code>@</code> signs are called substitution variables and are important part of the <b>Autotools</b> toolkit.
</p>

</div>

<p>
Let's reconfigure (<code>autoreconf -i &amp;&amp; ./configure</code>) and examine the changes between the input
<code>Makefile.in</code> and output <code>Makefile</code> (you can use <code>diff</code> or <code>vimdiff</code> for example):
</p>

<pre class="example">
$ diff Makefile.in Makefile

&lt; CXX      = @CXX@
&lt; CXXFLAGS = @CXXFLAGS@
---
&gt; CXX       = /home/user/.conda/envs/autotools/bin/x86_64-conda-linux-gnu-c++
&gt; CXXFLAGS  = -fPIC -isystem ${CONDA_PREFIX}/include
</pre>

<p>
This tells us that the substitution variables <code>@CXX@</code> and <code>@CXXFLAGS@</code> have been replaced
with the values detected by the <code>configure</code> script.
</p>

<div class="question">
<p>
In the example above, we forgot to add a compiler flag. Which one?
</p>

</div>

<p>
Good, but we still have the hard-coded path to <code>lib</code> directory in <code>LDFLAGS</code>.
Among other things, this directory contains the HDF5 library.
Let's try to find this library using <b>Autoconf</b> functionality.
</p>

<div class="tip">
<p>
To re-create quickly the <code>Makefile</code> without re-running <code>./configure</code>,
just run <code>./config.status</code> and the options of the previous
<code>./configure</code> will be used.
</p>

</div>
</div>
</div>

<div id="outline-container-orgefc22a2" class="outline-2">
<h2 id="orgefc22a2"><span class="section-number-2">5</span> Detecting external dependencies</h2>
<div class="outline-text-2" id="text-5">
<div class="important">
<p>
You can download the modified project, which contains the checkpoint corresponding to the beginning of this section. 
This might be useful if you did not type along during the previous part.
The link to the checkpoint version of the project is here:
<a href="https://github.com/q-posev/Sherman-Morrison/archive/refs/tags/v0.1-checkpoint.tar.gz">https://github.com/q-posev/Sherman-Morrison/archive/refs/tags/v0.1-checkpoint.tar.gz</a>
</p>

</div>

<p>
It is possible to write your our own macros to detect external dependencies.
However, in this example we will try to locate the HDF5 library, which is widely used.
Luckily for us, the GNU website has an <a href="https://www.gnu.org/software/autoconf-archive/The-Macros.html">archive of Autoconf macros</a> for many packages, including HDF5.
The <code>ax_lib_hdf5.m4</code> file can be downloaded/copied from 
<a href="http://git.savannah.gnu.org/gitweb/?p=autoconf-archive.git;a=blob_plain;f=m4/ax_lib_hdf5.m4">this webpage</a>.
</p>

<div class="tip">
<p>
It is considered good practice to put <b>Autoconf</b> macros in the <code>m4</code> directory of your source tree. 
This has been already done for you in the aforementioned checkpoint version of the project.
</p>

</div>

<p>
Once the file is in the <code>m4</code> directory, one can add the following lines to <code>configure.ac</code>
in order to locate and call the <code>ax_lib_hdf5.m4</code> macro:
</p>

<div class="org-src-container">
<pre class="src src-makefile"># <span style="color: #b22222;">tell Autoconf the name of directory with external M4 macros</span>
AC_CONFIG_MACRO_DIR([m4])
# <span style="color: #b22222;">call the m4 macro to locate the HDF5 library</span>
AX_LIB_HDF5()
</pre>
</div>

<p>
The description of this macro can be found <a href="https://www.gnu.org/software/autoconf-archive/ax_lib_hdf5.html">here</a>. Notably, it says:
</p>

<pre class="example">
If HDF5 is successfully found, this macro calls

  AC_SUBST(HDF5_VERSION)
  AC_SUBST(HDF5_CC)
  AC_SUBST(HDF5_CFLAGS)
  AC_SUBST(HDF5_CPPFLAGS)
  AC_SUBST(HDF5_LDFLAGS)
  AC_SUBST(HDF5_LIBS)
  AC_SUBST(HDF5_FC)
  AC_SUBST(HDF5_FFLAGS)
  AC_SUBST(HDF5_FLIBS)
  AC_SUBST(HDF5_TYPE)
  AC_DEFINE(HAVE_HDF5)

and sets with_hdf5="yes". ...
</pre>

<div class="tip">
<p>
The <code>AC_SUBST</code> macro defines a non-standard (e.g. project-specific) substitution variable.
Similarly, <code>AC_DEFINE</code> macro defines a preprocessor symbol, which can be used to write preprocessor conditionals.
</p>

</div>

<p>
This means that the macro will define a set of variables that can be manupulated
within <code>configure.ac</code> and/or <code>Makefile.in</code> files.
In this example, we choose the former and will append the necessary flags with the <code>HDF5_</code> ones.
</p>

<p>
<code>configure.ac</code>:
</p>
<div class="org-src-container">
<pre class="src src-makefile">#                                               <span style="color: #b22222;">-*- Autoconf -*-</span>
# <span style="color: #b22222;">Process this file with autoconf to produce a configure script.</span>

#<span style="color: #b22222;">initialize autoconf</span>
AC_INIT([sherman-morrison], [0.0.1], [])

# <span style="color: #b22222;">do the tests with C++ flags</span>
AC_LANG(C++)
# <span style="color: #b22222;">search for the C++ compiler</span>
AC_PROG_CXX
# <span style="color: #b22222;">check if the C++ compiler accepts -c and -o simultaneously</span>
AC_PROG_CXX_C_O

# <span style="color: #b22222;">tell Autoconf the name of directory with external M4 macros</span>
AC_CONFIG_MACRO_DIR([m4])
# <span style="color: #b22222;">call the m4 macro to locate the HDF5 library</span>
AX_LIB_HDF5()

# <span style="color: #b22222;">raise an error if HDF5 is missing</span>
if test <span style="color: #8b2252;">"x${</span><span style="color: #a0522d;">with_hdf5</span><span style="color: #8b2252;">}"</span> = xno; then
  AC_MSG_ERROR([
    ------------------------------------------
    Configuring with the HDF5 library is
    required to build this project.
    ------------------------------------------])
fi

# <span style="color: #b22222;">prepend compiler and linking flags with that of HDF5</span>
<span style="color: #a0522d;">CXXFLAGS</span>=<span style="color: #8b2252;">"${</span><span style="color: #a0522d;">HDF5_CFLAGS</span><span style="color: #8b2252;">} ${</span><span style="color: #a0522d;">CXXFLAGS</span><span style="color: #8b2252;">} -std=c++11"</span>
<span style="color: #a0522d;">CPPFLAGS</span>=<span style="color: #8b2252;">"${</span><span style="color: #a0522d;">HDF5_CPPFLAGS</span><span style="color: #8b2252;">} ${</span><span style="color: #a0522d;">CPPFLAGS</span><span style="color: #8b2252;">} -I./include/"</span>
<span style="color: #a0522d;">LDFLAGS</span>=<span style="color: #8b2252;">"${</span><span style="color: #a0522d;">HDF5_LDFLAGS</span><span style="color: #8b2252;">} ${</span><span style="color: #a0522d;">LDFLAGS</span><span style="color: #8b2252;">}"</span>
<span style="color: #a0522d;">LIBS</span>=<span style="color: #8b2252;">"${</span><span style="color: #a0522d;">HDF5_LIBS</span><span style="color: #8b2252;">} ${</span><span style="color: #a0522d;">LIBS</span><span style="color: #8b2252;">} -lhdf5_cpp"</span>

AC_CONFIG_FILES([Makefile])

AC_OUTPUT

echo \
<span style="color: #8b2252;">"-------------------------------------------------</span>

<span style="color: #8b2252;">${</span><span style="color: #a0522d;">PACKAGE_NAME</span><span style="color: #8b2252;">} Version ${</span><span style="color: #a0522d;">PACKAGE_VERSION</span><span style="color: #8b2252;">}</span>

<span style="color: #8b2252;">CXX ...........:  ${</span><span style="color: #a0522d;">CXX</span><span style="color: #8b2252;">}</span>
<span style="color: #8b2252;">CXXFLAGS ......:  ${</span><span style="color: #a0522d;">CXXFLAGS</span><span style="color: #8b2252;">}</span>
<span style="color: #8b2252;">CPPFLAGS ......:  ${</span><span style="color: #a0522d;">CPPFLAGS</span><span style="color: #8b2252;">}</span>
<span style="color: #8b2252;">LDFLAGS .......:  ${</span><span style="color: #a0522d;">LDFLAGS</span><span style="color: #8b2252;">}</span>
<span style="color: #8b2252;">LIBS ..........:  ${</span><span style="color: #a0522d;">LIBS</span><span style="color: #8b2252;">}</span>

<span style="color: #8b2252;">Package features:</span>
<span style="color: #8b2252;">  Compilation with HDF5 ..:  ${</span><span style="color: #a0522d;">with_hdf5</span><span style="color: #8b2252;">}</span>
<span style="color: #8b2252;">  HDF5 version ...........:  ${</span><span style="color: #a0522d;">HDF5_VERSION</span><span style="color: #8b2252;">}</span>

<span style="color: #8b2252;">--------------------------------------------------"</span>
</pre>
</div>

<p>
<code>Makefile.in</code> (only the top part has to be changed):
</p>
<div class="org-src-container">
<pre class="src src-makefile"><span style="color: #a0522d;">CXX</span>      = @CXX@
<span style="color: #a0522d;">CXXFLAGS</span> = @CXXFLAGS@
<span style="color: #a0522d;">CPPFLAGS</span> = @CPPFLAGS@
<span style="color: #a0522d;">LIBS</span>     = @LIBS@
<span style="color: #a0522d;">LDFLAGS</span>  = @LDFLAGS@
</pre>
</div>

<p>
Now reconfigure and examine the output produced by the <code>configure</code> script.
In the end, you will see a more verbose summary of the detected flags and
newly added package features. The exact output may differ on your machine depending
on the detected compiler and/or the HDF5 library.
</p>

<pre class="example">
-------------------------------------------------

sherman-morrison Version 0.0.1

CXX ...........:  /home/user/.conda/envs/autotools/bin/x86_64-conda-linux-gnu-c++
CXXFLAGS ......:   -fPIC -isystem ${CONDA_PREFIX}/include -std=c++11
CPPFLAGS ......:  -I/home/user/.conda/envs/autotools/include   -I./include/
LDFLAGS .......:   -L/home/user/.conda/envs/autotools/lib  
LIBS ..........:  -lhdf5_hl -lhdf5  -lcrypto -lcurl -lrt -lpthread -lz -ldl -lm   -lhdf5_cpp

Package features:
  Compilation with HDF5 ..:  yes
  HDF5 version ...........:  1.12.1

--------------------------------------------------
</pre>

<p>
You can now see how all hard-coded HDF5 paths have been detected by the <code>ax_lib_hdf5.m4</code> macro.
Moreover, all flags are propagated to the resulting <code>Makefile</code> due to the use of substitution variables.
</p>

<div class="exercise">
<p>
Examine the difference between <code>Makefile.in</code> and <code>Makefile</code>. 
Is it consistent with the aforementioned summary?
</p>

</div>

<div class="exercise">
<p>
Try to reconfigure using <code>./configure --without-hdf5</code> or <code>./configure --with-hdf5=no</code>. 
Which part of the <code>configure.ac</code> script produces the output message?
</p>

</div>
</div>
</div>

<div id="outline-container-org8575bed" class="outline-2">
<h2 id="org8575bed"><span class="section-number-2">6</span> pkg-config</h2>
<div class="outline-text-2" id="text-6">
<p>
The <a href="https://linux.die.net/man/1/pkg-config">pkg-config program</a> is a powerful tool to get information about installed libraries.
<b>Autoconf</b> incorporates some of the <code>pkg-config</code> functionality.
</p>

<p>
The <code>PKG_CHECK_MODULES</code> can be configured to detect and check the required version of the HDF5 library (see <a href="https://autotools.io/pkgconfig/pkg_check_modules.html">the Autotools Mythbuster website</a> for more details).
For example, <code>PKG_CHECK_MODULES([HDF5], [hdf5 &gt;= 1.8])</code> verifies that the HDF5 version is not older than <code>1.8</code>.
</p>

<p>
<code>configure.ac</code>:
</p>
<div class="org-src-container">
<pre class="src src-makefile">#                                               <span style="color: #b22222;">-*- Autoconf -*-</span>
# <span style="color: #b22222;">Process this file with autoconf to produce a configure script.</span>

#<span style="color: #b22222;">initialize autoconf</span>
AC_INIT([sherman-morrison], [0.0.1], [])

# <span style="color: #b22222;">do the tests with C++ flags</span>
AC_LANG(C++)
# <span style="color: #b22222;">search for the C++ compiler</span>
AC_PROG_CXX
# <span style="color: #b22222;">check if the C++ compiler accepts -c and -o simultaneously</span>
AC_PROG_CXX_C_O

# <span style="color: #b22222;">tell Autoconf the name of directory with external M4 macros</span>
AC_CONFIG_MACRO_DIR([m4])
# <span style="color: #b22222;">call the m4 macro to locate the HDF5 library</span>
AX_LIB_HDF5()

# <span style="color: #b22222;">raise an error if HDF5 is missing</span>
if test <span style="color: #8b2252;">"x${</span><span style="color: #a0522d;">with_hdf5</span><span style="color: #8b2252;">}"</span> = xno; then
  AC_MSG_ERROR([
    ------------------------------------------
    Configuring with the HDF5 library is
    required to build this project.
    ------------------------------------------])
fi

# <span style="color: #b22222;">prepend compiler and linking flags with that of HDF5</span>
<span style="color: #a0522d;">CXXFLAGS</span>=<span style="color: #8b2252;">"${</span><span style="color: #a0522d;">HDF5_CFLAGS</span><span style="color: #8b2252;">} ${</span><span style="color: #a0522d;">CXXFLAGS</span><span style="color: #8b2252;">} -std=c++11"</span>
<span style="color: #a0522d;">CPPFLAGS</span>=<span style="color: #8b2252;">"${</span><span style="color: #a0522d;">HDF5_CPPFLAGS</span><span style="color: #8b2252;">} ${</span><span style="color: #a0522d;">CPPFLAGS</span><span style="color: #8b2252;">} -I./include/"</span>
<span style="color: #a0522d;">LDFLAGS</span>=<span style="color: #8b2252;">"${</span><span style="color: #a0522d;">HDF5_LDFLAGS</span><span style="color: #8b2252;">} ${</span><span style="color: #a0522d;">LDFLAGS</span><span style="color: #8b2252;">}"</span>
<span style="color: #a0522d;">LIBS</span>=<span style="color: #8b2252;">"${</span><span style="color: #a0522d;">HDF5_LIBS</span><span style="color: #8b2252;">} ${</span><span style="color: #a0522d;">LIBS</span><span style="color: #8b2252;">} -lhdf5_cpp"</span>

# <span style="color: #b22222;">clean the output of AX_LIB_HDF5 macro since the same variables are substitutted by PKG_CHECK_MODULES</span>
<span style="color: #a0522d;">HDF5_CFLAGS</span>=<span style="color: #8b2252;">""</span>
<span style="color: #a0522d;">HDF5_LIBS</span>=<span style="color: #8b2252;">""</span>
# <span style="color: #b22222;">locate HDF5 with pkg-config</span>
PKG_CHECK_MODULES([HDF5], [hdf5 &gt;= 1.8])

AC_CONFIG_FILES([Makefile])

AC_OUTPUT

echo \
<span style="color: #8b2252;">"-------------------------------------------------</span>

<span style="color: #8b2252;">${</span><span style="color: #a0522d;">PACKAGE_NAME</span><span style="color: #8b2252;">} Version ${</span><span style="color: #a0522d;">PACKAGE_VERSION</span><span style="color: #8b2252;">}</span>

<span style="color: #8b2252;">CXX ...........:  ${</span><span style="color: #a0522d;">CXX</span><span style="color: #8b2252;">}</span>
<span style="color: #8b2252;">CXXFLAGS ......:  ${</span><span style="color: #a0522d;">CXXFLAGS</span><span style="color: #8b2252;">}</span>
<span style="color: #8b2252;">CPPFLAGS ......:  ${</span><span style="color: #a0522d;">CPPFLAGS</span><span style="color: #8b2252;">}</span>
<span style="color: #8b2252;">LDFLAGS .......:  ${</span><span style="color: #a0522d;">LDFLAGS</span><span style="color: #8b2252;">}</span>
<span style="color: #8b2252;">LIBS ..........:  ${</span><span style="color: #a0522d;">LIBS</span><span style="color: #8b2252;">}</span>

<span style="color: #8b2252;">Package features:</span>
<span style="color: #8b2252;">  Compilation with HDF5 ..:  ${</span><span style="color: #a0522d;">with_hdf5</span><span style="color: #8b2252;">}</span>
<span style="color: #8b2252;">  HDF5 version ...........:  ${</span><span style="color: #a0522d;">HDF5_VERSION</span><span style="color: #8b2252;">}</span>
<span style="color: #8b2252;">  .........................</span>
<span style="color: #8b2252;">  pkg-config CFLAGS ......:  ${</span><span style="color: #a0522d;">HDF5_CFLAGS</span><span style="color: #8b2252;">}</span>
<span style="color: #8b2252;">  pkg-config LIBS ........:  ${</span><span style="color: #a0522d;">HDF5_LIBS</span><span style="color: #8b2252;">}</span>

<span style="color: #8b2252;">--------------------------------------------------"</span>
</pre>
</div>

<p>
Reconfiguration should fail with the following error message:
</p>

<pre class="example">
checking for hdf5 &gt;= 1.8... no
configure: error: Package requirements (hdf5 &gt;= 1.8) were not met:

No package 'hdf5' found
</pre>

<p>
This might happen when package developers forgot to provide 
the configuration file for <code>pkg-config</code> or when it is installed in 
some non-standard location. 
</p>

<p>
Many <b>Autoconf</b> macros (including <code>PKG_CHECK_MODULES</code>) allow to specify
actions to be taken if a given file/program/library has been found or not.
In the case of <code>PKG_CHECK_MODULES</code>, the syntax is the following:
</p>

<pre class="example">
PKG_CHECK_MODULES(prefix, list-of-modules, action-if-found, action-if-not-found)
</pre>

<div class="exercise">
<p>
Modify the call to the <code>PKG_CHECK_MODULES</code> macro in order to raise a warning 
when HDF5 cannot be detected with <code>pkg-config</code>. This can be done using <code>AC_MSG_WARN</code> macro.
</p>

</div>

<p>
Notably, the raised warning allows the configuration to pass (unlike <code>AC_MSG_ERROR</code>).
</p>
</div>
</div>

<div id="outline-container-org32c4db1" class="outline-2">
<h2 id="org32c4db1"><span class="section-number-2">7</span> Conclusion</h2>
<div class="outline-text-2" id="text-7">
<p>
In this Tutorial you have learned how to make your in-house <code>Makefile</code> compatible with <b>Autoconf</b>.
This is achieved by converting <code>Makefile</code> into <code>Makefile.in</code> and introducing substitution variables.
You have also learned how to use <b>Autoconf</b> to create the <code>configure</code> script, which sets up and checks programs and libraries on the host machine.
The <code>configure</code> script is also responsible for producing the final <code>Makefile</code>, which is used to build the project.
Finally, you used the <b>Autoconf</b> macro from the GNU archive to configure the project, which has an external dependency (i.e. the HDF5 library).
</p>

<hr />
<a rel="license" href="http://creativecommons.org/licenses/by-sa/4.0/"><img alt="Creative Commons License" style="border-width:0" src="https://i.creativecommons.org/l/by-sa/4.0/88x31.png" /></a><br />This work is licensed under a <a rel="license" href="http://creativecommons.org/licenses/by-sa/4.0/">Creative Commons Attribution-ShareAlike 4.0 International License</a>.
</div>
</div>
</div>
<div id="postamble" class="status">
<p class="author">Author: Evgeny Posenitskiy, Anthony Scemama</p>
<p class="date">Created: 2021-11-08 Mon 19:34</p>
<p class="validation"><a href="http://validator.w3.org/check?uri=referer">Validate</a></p>
</div>
</body>
</html>
